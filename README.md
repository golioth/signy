# signy

Signed URLs for small devices.

## Background

`signy` is a library for generating signed URLs on embedded devices using
asymmetric cryptography. Signed URLs are typically utilized to grant
time-limited access to private resources, such as those served by a [Content
Delivery Network (CDN)](https://en.wikipedia.org/wiki/Content_delivery_network).
In the context of embedded devices, signed URLs may be used to enable an
external system, or another component in the same system, to access a specific
resource. For example, a device may generate a signed URL and pass it to a more
capable system to allow it to download the resource on its behalf.

Use of `signy` requires a server that is capable of verifying the signed URLs it
generates. If using `signy` with [Golioth](https://golioth.io), the certificates
associated with the Certificate Authority (CA) that issued the device
certificate must be [uploaded to your
project](https://docs.golioth.io/connectivity/credentials/pki#integrating-with-golioth).

## Usage

`signy` leverages the [Platform Security Architecture (PSA) Crypto
API](https://arm-software.github.io/psa-api/crypto/) for signing operations.
Private keys must be
[generated](https://arm-software.github.io/psa-api/crypto/1.3/api/keys/management.html#c.psa_generate_key)
or
[imported](https://arm-software.github.io/psa-api/crypto/1.3/api/keys/management.html#c.psa_import_key)
using PSA Crypto APIs, and a signed certificate containing the public key must
be passed to the `signy` library.

Signed URLs generated by `signy` adhere to the following format.

```
BASEURL?nb=NOTBEFORE&na=NOTAFTER&cert=CERTIFICATE&sig=SIGNATURE
```

- `BASEURL`: the location of the resource (e.g.
  `https://gw.golioth.io/.u/c/image@1.0.0`)
- `NOTBEFORE` / `NOTAFTER`: the unix timestamps defining the window in which the
  signed URL is valid. `signy` uses the device system time for `NOTBEFORE` and
  sets the `NOTAFTER` timestamp based on `CONFIG_SIGNY_URL_VALIDITY_DURATION`.
- `CERTIFICATE`: the base64 unpadded URL encoding of the device certificate.
- `SIGNATURE`: the signature over the entire portion of the URL preceding
  `&sig=`.

### Zephyr

The `signy` repository is a [Zephyr
module](https://docs.zephyrproject.org/latest/develop/modules.html) and can be
included in any Zephyr project by adding the following to the project's
`west.yml` file.

```yaml
- name: signy
  path: modules/lib/signy
  revision: main
  url: https://github.com/golioth/signy.git
```

See the Zephyr [examples](./examples/zephyr/) for more information.

### ESP-IDF

The `signy` repository is an [ESP-IDF
component](https://docs.espressif.com/projects/idf-component-manager/en/latest/guides/packaging_components.html)
and can be included in any ESP-IDF project by specifying it as a dependency in
the project's `idf_component.yml`.

```yaml
dependencies:
  signy:
    path: components/signy
    git: https://github.com/golioth/signy/esp-idf/signy
```

See the `esp-idf` [examples](./examples/esp-idf/) for more information.
